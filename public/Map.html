<div>

  <head>
    <title>Google Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 400px;
        width: 100%;
      }

      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>

  <body>
    <h1 id="city"></h1>
    <div id="map"></div>
    <script src="City.js"></script>
    <script>
      var map;
      function initMap() {
        var options = {
          center: { lat: -38.144323, lng: 175.494327 },
          zoom: 8
        }
        var geocoder = new google.maps.Geocoder();
        var map = new google.maps.Map(document.getElementById('map'), options);

        google.maps.event.addListener(map, 'click',
          function (event) {
            addMarker(event.latLng)
            geocoder.geocode({
              location: event.latLng,
            }, (results, status) => {
              if (status === 'OK') {
                if (results && results.length) {
                  var filtered_array = results.filter(result => result.types.includes("locality"));
                  var addressResult = filtered_array.length ? filtered_array[0] : results[0];

                  if (addressResult.address_components) {
                    addressResult.address_components.forEach((component) => {
                      if (component.types.includes('locality')) {
                        document.getElementById("city").textContent = component.long_name
                        console.log(component.long_name)

                        var cityName = component.long_name
                        var handleZipChange = async (cityName) => {
                          const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?appid=6b7b471967dd0851d0010cdecf28f829&units=metric&q=${cityName},nz`)
                          const json = await res.json()
                          console.log(json);
                          var table = document.getElementById("table")
                          if (json.cod === 200) {

                            table.innerHTML = "";
                            var row1 = table.insertRow();
                            var cell1 = row1.insertCell();
                            var cell2 = row1.insertCell();
                            cell1.innerHTML = "city";
                            cell2.innerHTML = json.name;
                            var row1 = table.insertRow();
                            var cell1 = row1.insertCell();
                            var cell2 = row1.insertCell();
                            cell1.innerHTML = "Temperature";
                            cell2.innerHTML = json.main.temp;
                            var row1 = table.insertRow();
                            var cell1 = row1.insertCell();
                            var cell2 = row1.insertCell();
                            cell1.innerHTML = "Pressure";
                            cell2.innerHTML = json.main.pressure;
                            var row1 = table.insertRow();
                            var cell1 = row1.insertCell();
                            var cell2 = row1.insertCell();
                            cell1.innerHTML = "Humidity";
                            cell2.innerHTML = json.main.humidity;
                            var row1 = table.insertRow();
                            var cell1 = row1.insertCell();
                            var cell2 = row1.insertCell();
                            cell1.innerHTML = "Temperature (min)";
                            cell2.innerHTML = json.main.temp_min;
                            var row1 = table.insertRow();
                            var cell1 = row1.insertCell();
                            var cell2 = row1.insertCell();
                            cell1.innerHTML = "Temperature (max)";
                            cell2.innerHTML = json.main.temp_max;
                            var row1 = table.insertRow();
                            var cell1 = row1.insertCell();
                            var cell2 = row1.insertCell();
                            cell1.innerHTML = "Conditions";
                            cell2.innerHTML = json.weather[0].description;
                          }
                          else {
                            table.innerHTML = "";
                          }
                        }
                        handleZipChange(cityName)




                      }
                    });
                  }
                }
              }
            });
          })
        addMarker({ lat: 42.4668, lng: -70.975 })
        var markers = [
          {
            lat: -37.783804, lng: 175.268012
          }

        ]

        for (var i = 0; i < markers.length; i++) {
          addMarker(markers[i])
        }


        function addMarker(coords) {
          var marker = new google.maps.Marker({
            position: coords,
            map: map
          })
        }
      }
    </script>
    <table id="table">
      <tbody>
        
      </tbody>
  </table>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDC5hRgGLL5PnDN3ysBNnIGAkAjUIrEIDQ&callback=initMap"
      async defer></script>
  </body>
</div>